# Story 3.8: Project Scaffolding (package.json, README, Config Files) - Brownfield Addition

**Epic:** Epic 3: TypeScript Code Generation System

---

## User Story

**As a** user,
**I want** the generator to create a complete project structure,
**So that** the generated MCP server is immediately usable.

---

## Story Context

**Existing System Integration:**

- Integrates with: Generator package from Stories 3.1-3.7, parser package from Epic 2
- Technology: TypeScript 5.x, npm/pnpm, template engine
- Follows pattern: Code generation pipeline, project structure creation
- Touch points: All generated code from Stories 3.2-3.7, file system utilities from Story 1.4

**Epic Context:**

This story creates the complete project scaffolding around the generated code. After all TypeScript code is generated (Stories 3.2-3.7), we need to create package.json, configuration files, documentation, and scripts to make the MCP server a runnable, distributable project.

**Project Context:**

Project scaffolding transforms generated code into a complete, ready-to-use Node.js project. It includes dependency management, build configuration, environment setup, and user documentation. For the Ozon Performance API, this creates a professional, production-ready MCP server that users can install, configure, and run immediately.

---

## Acceptance Criteria

### Functional Requirements

1. **Scaffolding Generator Module Creation**
   - Create `packages/generator/src/scaffolder.ts` module
   - Export `scaffoldProject(outputDir, metadata)` function
   - Function creates complete project structure
   - Support configurable project templates

2. **package.json Generation**
   - Generate valid package.json with all required fields
   - Name: derived from API title (kebab-case)
   - Version: 1.0.0 (or from OpenAPI version)
   - Description: from OpenAPI description
   - Main: dist/index.js
   - Type: "module" (ES modules)
   - Scripts: build, start, dev, test
   - Keywords: MCP, API name, generated
   - License: MIT (or configurable)

3. **Dependencies Configuration**
   - Required dependencies with exact versions:
     - `@modelcontextprotocol/sdk`: ^0.5.0
     - `axios`: ^1.6.0
     - `dotenv`: ^16.3.0
   - Dev dependencies:
     - `typescript`: ^5.3.0
     - `@types/node`: ^20.10.0
     - `tsx`: ^4.7.0 (for dev mode)
   - Engines: `node: ">=18.0.0"`

4. **Scripts Configuration**
   - `build`: "tsc" (compile TypeScript)
   - `start`: "node dist/index.js" (run server)
   - `dev`: "tsx watch src/index.ts" (development mode)
   - `typecheck`: "tsc --noEmit" (type checking only)
   - Optional: `test`, `lint` (if test files generated)

5. **tsconfig.json Generation**
   - Strict mode enabled
   - Target: ES2020 or ES2022
   - Module: NodeNext (ES modules)
   - Module resolution: NodeNext
   - Output directory: dist/
   - Include: src/**/*
   - Exclude: node_modules, dist
   - Source maps: true (for debugging)
   - Declaration: true (generate .d.ts files)

6. **.env.example Generation**
   - Template environment variables with examples
   - API_BASE_URL: from server URL (Story 2.8)
   - API_TIMEOUT: 30000
   - DEBUG: false
   - Authentication variables (Epic 4 placeholders):
     - API_KEY: your-api-key-here (commented)
     - BEARER_TOKEN: your-token-here (commented)
   - Include helpful comments explaining each variable

7. **.gitignore Generation**
   - Ignore: node_modules/, dist/, .env
   - Include: .env.example
   - Ignore: *.log, .DS_Store, coverage/
   - Standard Node.js .gitignore template

8. **README.md Generation**
   - Project title: from API name
   - Description: from OpenAPI description
   - Features: list of capabilities
   - Installation: npm install instructions
   - Configuration: environment variables setup
   - Usage: how to run with Claude Desktop
   - API Documentation: link to generated docs or OpenAPI spec
   - License: MIT (or configured)

9. **Directory Structure Creation**
   - Root: package.json, tsconfig.json, README.md, .gitignore, .env.example
   - src/: all generated TypeScript files
   - dist/: compiled JavaScript (after build)
   - Validate structure before file creation

10. **ESLint Configuration (Optional)**
    - Generate .eslintrc.json with TypeScript rules
    - Extends: @typescript-eslint/recommended
    - Rules: standard TypeScript best practices
    - Parser: @typescript-eslint/parser
    - Plugins: @typescript-eslint

11. **Prettier Configuration**
    - Generate .prettierrc with formatting rules
    - Single quotes: true
    - Trailing comma: all
    - Print width: 100
    - Tab width: 2
    - Semi: true
    - Arrow parens: always

12. **License File Generation**
    - MIT license (default)
    - Include copyright year and placeholder name
    - Configurable license type
    - Full license text

### Integration Requirements

13. **File System Integration**
    - Use file system utilities from Story 1.4
    - Create directories recursively
    - Write all configuration files
    - Handle existing files (prompt or --force)
    - Set proper file permissions

14. **Metadata Integration**
    - Use API metadata from parser (Story 2.1-2.8)
    - API name: from OpenAPI info.title
    - API version: from OpenAPI info.version
    - API description: from OpenAPI info.description
    - Server URLs: from Story 2.8
    - Security schemes: from Story 2.6 (for .env.example)

15. **Generated Code Integration**
    - Ensure all generated files (3.2-3.7) in correct locations
    - src/types.ts (Story 3.2)
    - src/http-client.ts (Story 3.3)
    - src/index.ts (Story 3.4)
    - src/tools.ts (Stories 3.5-3.7)
    - Validate imports between files

### Quality Requirements

16. **Testing Coverage**
    - Unit test: package.json generation with correct fields
    - Unit test: Dependencies include all required packages
    - Unit test: Scripts are correctly configured
    - Unit test: tsconfig.json valid TypeScript config
    - Unit test: .env.example includes all variables
    - Unit test: .gitignore includes standard patterns
    - Unit test: README.md includes all sections
    - Unit test: Directory structure created correctly
    - Integration test: Generated project npm install succeeds
    - Integration test: Generated project npm run build succeeds
    - Test coverage ≥80% for scaffolder module

17. **Documentation Updates**
    - Document scaffolder in generator README
    - Add project structure diagram
    - Document customization options
    - Include template customization guide
    - Add examples of generated projects

18. **Code Quality**
    - TypeScript strict mode compliance
    - Generated configs valid (JSON, TypeScript)
    - All files properly formatted
    - No placeholder/TODO comments in generated files
    - Scaffolding completes in <1 second

---

## Technical Notes

### Integration Approach

**Scaffolder Module:**
```typescript
// packages/generator/src/scaffolder.ts
export interface ScaffoldOptions {
  outputDir: string;
  apiName: string;
  apiVersion: string;
  apiDescription?: string;
  baseURL: string;
  license?: string;
  author?: string;
  repository?: string;
}

export async function scaffoldProject(
  options: ScaffoldOptions
): Promise<void> {
  const { outputDir, apiName, apiVersion, apiDescription, baseURL } = options;

  // Create directory structure
  await createDirectoryStructure(outputDir);

  // Generate configuration files
  await generatePackageJson(outputDir, options);
  await generateTsConfig(outputDir);
  await generateEnvExample(outputDir, options);
  await generateGitIgnore(outputDir);
  await generateReadme(outputDir, options);
  await generatePrettierConfig(outputDir);
  await generateEslintConfig(outputDir);
  await generateLicense(outputDir, options);

  // Validate structure
  await validateProjectStructure(outputDir);
}

async function createDirectoryStructure(outputDir: string): Promise<void> {
  const dirs = [
    outputDir,
    path.join(outputDir, 'src')
  ];

  for (const dir of dirs) {
    await fs.mkdir(dir, { recursive: true });
  }
}
```

**package.json Template:**
```json
{
  "name": "{{packageName}}",
  "version": "{{apiVersion}}",
  "description": "{{apiDescription}}",
  "type": "module",
  "main": "dist/index.js",
  "bin": {
    "{{binName}}": "dist/index.js"
  },
  "scripts": {
    "build": "tsc",
    "start": "node dist/index.js",
    "dev": "tsx watch src/index.ts",
    "typecheck": "tsc --noEmit"
  },
  "keywords": [
    "mcp",
    "model-context-protocol",
    "{{apiName}}",
    "api-client"
  ],
  "engines": {
    "node": ">=18.0.0"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^0.5.0",
    "axios": "^1.6.0",
    "dotenv": "^16.3.0"
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "typescript": "^5.3.0",
    "tsx": "^4.7.0"
  },
  "license": "{{license}}",
  "author": "{{author}}",
  "repository": "{{repository}}"
}
```

**tsconfig.json Template:**
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

**.env.example Template:**
```bash
# {{apiName}} MCP Server Configuration
# Copy this file to .env and fill in your values

# API Base URL
API_BASE_URL={{baseURL}}

# API Timeout (milliseconds)
API_TIMEOUT=30000

# Authentication (uncomment and configure as needed)
{{#if hasApiKey}}
# API_KEY=your-api-key-here
{{/if}}
{{#if hasBearerToken}}
# BEARER_TOKEN=your-bearer-token-here
{{/if}}
{{#if hasBasicAuth}}
# BASIC_AUTH_USERNAME=your-username
# BASIC_AUTH_PASSWORD=your-password
{{/if}}

# Debug Mode (set to 'true' to enable verbose logging)
DEBUG=false
```

**README.md Template:**
```markdown
# {{apiName}} MCP Server

{{apiDescription}}

MCP server for the {{apiName}} API, generated from OpenAPI specification.

## Features

- ✅ **{{operationCount}} API operations** available as MCP tools
- ✅ **Type-safe** TypeScript implementation
- ✅ **Automatic retries** with exponential backoff
- ✅ **Authentication** support (API Key, Bearer Token, Basic Auth)
- ✅ **Error handling** with detailed error messages
- ✅ **Full MCP protocol** compatibility

## Installation

```bash
npm install
```

## Configuration

1. Copy the example environment file:
```bash
cp .env.example .env
```

2. Edit `.env` and configure your API credentials:
```bash
API_BASE_URL={{baseURL}}
{{#if hasAuthentication}}
API_KEY=your-api-key-here
{{/if}}
```

## Usage

### Build the project

```bash
npm run build
```

### Run the MCP server

```bash
npm start
```

### Development mode (with auto-reload)

```bash
npm run dev
```

### Use with Claude Desktop

Add to your Claude Desktop configuration (`~/Library/Application Support/Claude/claude_desktop_config.json`):

```json
{
  "mcpServers": {
    "{{packageName}}": {
      "command": "node",
      "args": ["/path/to/{{packageName}}/dist/index.js"]
    }
  }
}
```

## Available Tools

This MCP server provides {{operationCount}} tools for interacting with the {{apiName}} API.

{{#if tags}}
### By Category
{{#each tags}}
- **{{name}}**: {{operationCount}} operations
{{/each}}
{{/if}}

Use the `listMethods` tool in Claude to discover available operations.

## Documentation

- [OpenAPI Specification](./openapi.yaml) (if included)
- [API Documentation]({{externalDocsUrl}})

## Troubleshooting

### Server won't start
- Check that Node.js version is >=18.0.0: `node --version`
- Verify all dependencies are installed: `npm install`
- Check your `.env` file has correct configuration

### Authentication errors
- Verify your API credentials in `.env` file
- Check that credentials have necessary permissions

### Debug mode
Enable debug logging to see detailed request/response information:
```bash
DEBUG=true npm start
```

## License

{{license}}

---

Generated with [OpenAPI-to-MCP Generator](https://github.com/your-org/openapi-to-mcp)
```

**CLI Integration:**
```typescript
// packages/cli/src/commands/generate.ts
import { scaffoldProject } from '@openapi-to-mcp/generator';

async function generateCommand(openApiPath: string, options: Options) {
  const parseResult = await parseOpenAPIDocument(openApiPath);

  // Stories 3.2-3.7: Generate all TypeScript code
  // ... (previous code generation)

  // Story 3.8: Scaffold complete project
  logger.info('Scaffolding project structure...');

  await scaffoldProject({
    outputDir: options.output,
    apiName: parseResult.metadata.apiName,
    apiVersion: parseResult.metadata.apiVersion,
    apiDescription: parseResult.document.info.description,
    baseURL: parseResult.servers.defaultServer.baseURL,
    license: options.license || 'MIT',
    author: options.author,
    repository: options.repository
  });

  logger.info('✓ Project scaffolding complete');
  logger.info('');
  logger.info('Next steps:');
  logger.info(`  1. cd ${options.output}`);
  logger.info('  2. npm install');
  logger.info('  3. cp .env.example .env');
  logger.info('  4. Edit .env with your API credentials');
  logger.info('  5. npm run build');
  logger.info('  6. npm start');

  // Continue with validation (Story 3.9)...
}
```

### Existing Pattern Reference

- **Generator Architecture:** Story 3.1 template engine
- **File System:** Story 1.4 file utilities
- **Parser Metadata:** Stories 2.1-2.8 for project details
- **Generated Code:** Stories 3.2-3.7 TypeScript files

### Key Constraints

- **No Breaking Changes:** Must not modify Epic 1-2 or Stories 3.1-3.7
- **Performance:** Scaffolding completes in <1 second
- **Validity:** All generated configs must be valid
- **Completeness:** Project must be immediately runnable
- **Standards:** Follow Node.js/npm best practices

### Dependencies

**External Libraries:**
- None (generates standard config files)

**Internal Dependencies:**
- Story 3.1: Generator architecture
- Stories 3.2-3.7: Generated code files
- Stories 2.1-2.8: Parser metadata
- Story 1.4: File system utilities

---

## Definition of Done

- [x] Functional requirements 1-12 met
- [x] Integration requirements 13-15 verified
- [x] Scaffolding generator module created (`src/scaffolder.ts`)
- [x] `scaffoldProject()` function implemented
- [x] package.json generation working
- [x] Dependencies configuration correct
- [x] Scripts configuration working
- [x] tsconfig.json generation working
- [x] .env.example generation working
- [x] .gitignore generation working
- [x] README.md generation working
- [x] Directory structure creation working
- [x] ESLint configuration (optional) working
- [x] Prettier configuration working
- [x] License file generation working
- [x] File system integration successful
- [x] Metadata integration working
- [x] Generated code integration verified
- [x] All tests pass (≥80% coverage)
- [x] Generated project npm install succeeds
- [x] Generated project npm run build succeeds
- [x] All configs valid (JSON, TypeScript)
- [x] Documentation complete (guide, examples)
- [x] Performance validated (<1 second scaffolding)
- [x] Tested with Ozon API project generation

---

## Risk and Compatibility Check

### Minimal Risk Assessment

**Primary Risk:** Invalid package.json or tsconfig.json preventing project from building

**Mitigation:**
- Validate all JSON configs before writing
- Test npm install and build in CI
- Use standard, proven configurations
- Test with multiple Node.js versions (18, 20, 22)
- Comprehensive integration tests

**Rollback:**
- Scaffolding creates new files
- Can delete output directory and regenerate
- No state changes or permanent modifications

### Compatibility Verification

- [x] No breaking changes to existing APIs (Epic 1-2, Stories 3.1-3.7 unchanged)
- [x] Database changes: N/A (no database)
- [x] Generated configs valid and standard-compliant
- [x] Node.js ≥18 compatibility
- [x] npm/pnpm/yarn compatible

---

## Validation Checklist

### Scope Validation

- [x] Story can be completed in one development session (6-8 hours)
- [x] Integration approach is straightforward (file generation)
- [x] Follows existing patterns (generator, templates)
- [x] Completes Epic 3 code generation pipeline

### Clarity Check

- [x] Story requirements are unambiguous
- [x] Integration points clearly specified (all generated files)
- [x] Success criteria are testable (build succeeds)
- [x] Configuration requirements explicitly defined

---

## Success Criteria

The story is successful when:

1. ✅ Scaffolding generator creates complete project structure
2. ✅ package.json valid with all required dependencies
3. ✅ Scripts configured correctly (build, start, dev)
4. ✅ tsconfig.json valid TypeScript configuration
5. ✅ .env.example includes all necessary variables
6. ✅ .gitignore includes standard patterns
7. ✅ README.md comprehensive and helpful
8. ✅ Directory structure correct (src/, dist/)
9. ✅ ESLint/Prettier configs valid
10. ✅ License file generated
11. ✅ Generated project `npm install` succeeds
12. ✅ Generated project `npm run build` succeeds
13. ✅ Generated project `npm start` runs without errors
14. ✅ All files properly formatted
15. ✅ Test coverage ≥80% with all tests passing
16. ✅ Performance target met (<1 second)
17. ✅ Tested with Ozon API project successfully
18. ✅ Documentation complete
19. ✅ Ready for Story 3.9 integration testing

---

## Notes

- **Epic Sequence:** Story 3.8 builds on Stories 3.1-3.7 and precedes Story 3.9 (Integration Testing)
- **Dependency:** Stories 3.1-3.7 must be complete before starting this story
- **Next Story:** Story 3.9 (Integration Testing) validates the complete generated project
- **Standards:** Follow Node.js and npm best practices
- **Testing:** Critical to verify npm install and build work
- **Documentation:** README must be clear for end users
- **Professional:** Generated project should look production-ready

---

**Story Created:** 2025-01-04
**Epic:** Epic 3: TypeScript Code Generation System
**Story Number:** 3.8
**Estimated Effort:** 6-8 hours
