# Story 1.8: Development Documentation and Contributing Guide

## Status

Approved

## Story

**As a** contributor,
**I want** clear documentation on how to set up the development environment and contribute,
**so that** I can start working on the project efficiently.

## Acceptance Criteria

1. `CONTRIBUTING.md` created with development setup instructions
2. Documentation includes: prerequisites (Node.js version), installation steps, running tests, building packages
3. Code style guidelines documented (ESLint/Prettier usage)
4. PR process described: branch naming, commit message format, review requirements
5. Architecture overview added to `docs/architecture.md` explaining monorepo structure
6. Each package has its own `README.md` explaining its purpose and API
7. Example development workflow documented: make change → run tests → create PR
8. Troubleshooting section for common development issues

## Tasks / Subtasks

- [ ] Review project structure and existing documentation (AC: 1-8)
  - [ ] Review current monorepo structure from previous stories (1.1-1.7)
  - [ ] Identify all packages created: cli, parser, generator, templates
  - [ ] Review architecture documentation in docs/architecture/
  - [ ] Identify gaps in development documentation
  - [ ] Review Epic 1 completion status and what's been implemented
  - [ ] Document current development environment setup

- [ ] Create CONTRIBUTING.md with setup instructions (AC: 1, 2)
  - [ ] Create `CONTRIBUTING.md` at repository root
  - [ ] Document prerequisites: Node.js 20.11.0 LTS, pnpm 8.15.1
  - [ ] Write installation steps: clone repo, install dependencies
  - [ ] Document workspace commands: npm install, npm test, npm run build
  - [ ] Explain monorepo structure and package organization
  - [ ] Add quick start guide for first-time contributors
  - [ ] Include links to architecture documentation

- [ ] Document code style guidelines (AC: 3)
  - [ ] Document ESLint configuration and rules
  - [ ] Document Prettier configuration and formatting standards
  - [ ] Explain TypeScript strict mode requirements
  - [ ] Document naming conventions (files, variables, functions)
  - [ ] Document import/export patterns (ESM modules)
  - [ ] Reference coding standards from docs/architecture/architecture.md#coding-standards
  - [ ] Include code examples demonstrating style

- [ ] Document PR process and workflow (AC: 4, 7)
  - [ ] Document branch naming convention: feature/story-X.Y-description, fix/issue-description
  - [ ] Document commit message format: conventional commits or project standard
  - [ ] Explain PR template and required sections
  - [ ] Document review requirements: approvals needed, CI must pass
  - [ ] Document example development workflow: branch → code → test → PR → review → merge
  - [ ] Include checklist for PR authors
  - [ ] Document testing requirements before PR submission

- [ ] Update architecture documentation (AC: 5)
  - [ ] Review docs/architecture/architecture.md current state
  - [ ] Ensure monorepo structure is clearly explained
  - [ ] Verify pipeline architecture diagram is accurate
  - [ ] Add development-focused sections if missing
  - [ ] Ensure alignment with implemented structure from Stories 1.1-1.7
  - [ ] Add references to package READMEs

- [ ] Create package-level README files (AC: 6)
  - [ ] Create packages/cli/README.md
    - [ ] Explain CLI package purpose (command-line interface orchestration)
    - [ ] Document CLI commands and flags
    - [ ] Provide usage examples
    - [ ] Document key interfaces and exports
    - [ ] Link to architecture documentation
  - [ ] Create packages/parser/README.md
    - [ ] Explain parser package purpose (OpenAPI validation and normalization)
    - [ ] Document parsing functions and types
    - [ ] Provide usage examples
    - [ ] Document error handling
    - [ ] Link to architecture data models
  - [ ] Create packages/generator/README.md
    - [ ] Explain generator package purpose (code generation orchestration)
    - [ ] Document generation functions and templates
    - [ ] Provide usage examples
    - [ ] Document file structure output
    - [ ] Link to architecture documentation
  - [ ] Create packages/templates/README.md
    - [ ] Explain templates package purpose (boilerplate templates)
    - [ ] Document available templates
    - [ ] Explain template structure
    - [ ] Provide customization guidance

- [ ] Create troubleshooting guide (AC: 8)
  - [ ] Add Troubleshooting section to CONTRIBUTING.md
  - [ ] Document common issues and solutions:
    - [ ] pnpm workspace resolution errors
    - [ ] TypeScript compilation errors across packages
    - [ ] Test failures and debugging strategies
    - [ ] CI/CD pipeline failures
    - [ ] Dependency version conflicts
  - [ ] Document debugging techniques
  - [ ] Include FAQ for common questions
  - [ ] Add links to relevant GitHub issues or discussions

- [ ] Document testing workflow (AC: 2, 7)
  - [ ] Document how to run tests: npm test, npm run test:coverage
  - [ ] Explain test organization: unit tests, integration tests, e2e tests
  - [ ] Document coverage requirements (≥80% from Story 1.6)
  - [ ] Explain how to run package-specific tests
  - [ ] Document test debugging with --verbose flag
  - [ ] Reference testing strategy from docs/architecture/architecture.md#test-strategy
  - [ ] Include examples of writing tests

- [ ] Document build and development workflow (AC: 2, 7)
  - [ ] Document how to build packages: npm run build
  - [ ] Explain build output and dist/ directories
  - [ ] Document watch mode for development (if applicable)
  - [ ] Explain how to test CLI locally during development
  - [ ] Document how to link packages for local testing
  - [ ] Include workflow diagram or flowchart

- [ ] Create development environment setup guide (AC: 2)
  - [ ] Document IDE recommendations (VS Code with extensions)
  - [ ] Document .vscode/ workspace settings
  - [ ] Document recommended VS Code extensions: ESLint, Prettier, TypeScript
  - [ ] Document environment variable setup (.env.example files)
  - [ ] Document git hooks setup (if using husky)
  - [ ] Include platform-specific notes (macOS, Linux, Windows)

- [ ] Validate documentation completeness (AC: 1-8)
  - [ ] Review CONTRIBUTING.md against acceptance criteria
  - [ ] Review all package READMEs for completeness
  - [ ] Test setup instructions on clean environment
  - [ ] Verify all links work and point to correct sections
  - [ ] Check for spelling and grammar errors
  - [ ] Ensure code examples are accurate and tested
  - [ ] Get peer review of documentation from another developer

- [ ] Create documentation examples and templates (AC: 6, 7)
  - [ ] Add example PR description template (.github/PULL_REQUEST_TEMPLATE.md)
  - [ ] Add example issue template (.github/ISSUE_TEMPLATE/)
  - [ ] Create code snippet examples in CONTRIBUTING.md
  - [ ] Document git workflow with diagrams if helpful

## Dev Notes

### Documentation Purpose and Scope
[Source: Epic 1 Story 1.8 - Development Documentation and Contributing Guide]

**Epic 1 Completion**: This story completes Epic 1 (Foundation & Core CLI Infrastructure). The goal is to document the foundational infrastructure created in Stories 1.1-1.7 so contributors can effectively work on the project.

**Documentation Audience**:
- **Primary**: New contributors (developers, AI agents) setting up development environment
- **Secondary**: Maintainers reviewing PRs and managing releases

**Key Deliverables**:
1. `CONTRIBUTING.md` - Central development guide
2. Package `README.md` files - Package-specific documentation
3. Updated architecture documentation - Alignment with implemented structure
4. Troubleshooting guide - Common issues and solutions

### Project Structure Context
[Source: Stories 1.1-1.7 implementation context]

**Monorepo Structure** (from Story 1.1):
```
openapi-to-mcp/
├── .github/workflows/        # CI/CD pipelines (Story 1.2)
│   └── test.yml
├── packages/
│   ├── cli/                  # CLI package (Story 1.3)
│   ├── parser/               # Parser package (stub)
│   ├── generator/            # Generator package (Story 1.4)
│   └── templates/            # Templates package (Story 1.5)
├── docs/
│   ├── architecture/         # Architecture docs
│   ├── stories/              # User stories
│   └── prd/                  # Product requirements
├── coverage/                 # Test coverage (Story 1.6)
├── vitest.config.ts          # Test configuration (Story 1.6)
├── pnpm-workspace.yaml       # Workspace configuration (Story 1.1)
├── package.json              # Root package.json
├── tsconfig.json             # TypeScript config (Story 1.1)
└── README.md                 # Project README
```

**Implemented Features** (Stories 1.1-1.7):
- ✅ Story 1.1: Monorepo structure with pnpm workspaces
- ✅ Story 1.2: CI/CD with GitHub Actions
- ✅ Story 1.3: CLI framework with Commander.js
- ✅ Story 1.4: File system operations and output structure
- ✅ Story 1.5: Hello world MCP server template
- ✅ Story 1.6: Vitest testing framework with coverage
- ✅ Story 1.7: Error handling and logging system (Draft)

### Tech Stack Reference
[Source: docs/architecture/architecture.md#tech-stack]

**Development Prerequisites**:
- **Node.js**: 20.11.0 LTS (required by MCP SDK ≥18.0.0)
- **Package Manager**: pnpm 8.15.1 (monorepo workspace management)
- **TypeScript**: 5.3.3 (strict mode enabled)

**Development Dependencies**:
- **ESLint**: 8.56.0 (code quality)
- **Prettier**: 3.2.4 (code formatting)
- **Vitest**: 1.2.0 (testing framework)
- **TypeScript**: 5.3.3 (type checking)

**Package Manager Rationale**:
[Source: docs/architecture/architecture.md#high-level-architecture]
- pnpm: 30-50% faster installs than npm
- Strict dependency resolution (prevents phantom dependencies)
- Workspace support for monorepo

### Coding Standards Reference
[Source: docs/architecture/architecture.md#coding-standards]

**Core Standards** to document in CONTRIBUTING.md:

1. **Languages**: TypeScript 5.3.3 (strict mode), Node.js ≥18.0.0
2. **Module System**: ESM only (`import`/`export`)
3. **Style**: ESLint 8.56.0 + Prettier 3.2.4
4. **Testing**: Vitest 1.2.0, ≥80% coverage

**Critical Rules** (from architecture):
1. Never use `console.log` - Use `debug` library (Story 1.7)
2. All async must have error handling - Wrap in try-catch
3. All file ops use absolute paths - Use `path.resolve()`
4. Never hardcode secrets - Use `process.env`
5. All generated TS must compile - Run `tsc --noEmit` before write
6. Sanitize operationIds - Ensure valid TypeScript identifiers
7. All errors must be typed - Use custom error classes (Story 1.7)
8. External $refs must be HTTPS - Reject HTTP URLs
9. Use `unknown` not `any` - Force explicit type checking
10. Avoid non-null assertions - Use optional chaining

### Testing Strategy Reference
[Source: docs/architecture/architecture.md#test-strategy]

**Testing Philosophy** to document:
- **Approach**: TDD for critical paths
- **Coverage Goals**: Unit ≥80%, Integration ≥70%, E2E 100%
- **Test Pyramid**: 70% Unit, 25% Integration, 5% E2E

**Test Execution Commands**:
```bash
# Run all tests
npm test

# Run with coverage
npm run test:coverage

# Watch mode
npm run test:watch

# Package-specific tests
npm test --workspace=packages/cli
```

**Test Organization**:
- Unit tests: `__tests__/` directory in each package
- Integration tests: `tests/integration/` at root
- E2E tests: `tests/e2e/` at root
- Test fixtures: `tests/fixtures/` or `__tests__/fixtures/`

### Git Workflow and PR Process
[Source: docs/architecture/architecture.md#infrastructure-and-deployment]

**Branch Naming Convention**:
- Features: `feature/story-1.2-cli-framework`
- Fixes: `fix/issue-123-parser-error`
- Docs: `docs/update-contributing-guide`

**Commit Message Format**:
Recommend conventional commits format:
```
type(scope): description

[optional body]

[optional footer]
```

Types: `feat`, `fix`, `docs`, `test`, `refactor`, `chore`, `ci`

**PR Requirements**:
- All tests pass (CI must be green)
- Code coverage ≥80%
- TypeScript compilation successful
- ESLint passes with no errors
- At least 1 approval from maintainer
- All commits signed (if required)

### CI/CD Pipeline Reference
[Source: Story 1.2 - CI/CD Pipeline with GitHub Actions]

**GitHub Actions Workflows**:
- **test.yml**: Runs on push/PR - tests, linting, type checking
- **publish.yml**: Runs on git tag - npm publishing (future)

**CI Environment**:
- Node.js versions: 18, 20, 22 (matrix)
- Operating systems: Ubuntu, macOS, Windows
- Cache: node_modules cached for faster builds

**Status Checks**:
- All tests must pass
- Coverage must meet thresholds
- No TypeScript errors
- No ESLint errors

### Package-Level Documentation Guidance

**CLI Package README** (`packages/cli/README.md`):
- Purpose: Command-line interface for OpenAPI-to-MCP generation
- Commands: `generate <openapi-path> --output <dir>`
- Flags: `--format`, `--verbose`, `--auth-type`, `--help`, `--version`
- Entry point: `src/index.ts` or `src/cli.ts`
- Key exports: `generate()`, error classes

**Parser Package README** (`packages/parser/README.md`):
- Purpose: OpenAPI 3.0 validation, $ref resolution, normalization
- Key functions: `parseOpenAPI()`, `validateSchema()`, `resolveReferences()`
- Dependencies: `@apidevtools/swagger-parser@10.1.0`
- Error handling: Custom error classes for parser errors

**Generator Package README** (`packages/generator/README.md`):
- Purpose: Code generation orchestration, template rendering
- Key functions: `generateMCPServer()`, `generateTypes()`, `renderTemplate()`
- Dependencies: `ts-morph@21.0.1`, `handlebars@4.7.8`
- Output: MCP server directory with package.json, src/, README.md

**Templates Package README** (`packages/templates/README.md`):
- Purpose: Handlebars templates for MCP server boilerplate
- Templates: `mcp-server/`, `auth/`, `http/`, `config/`, `docs/`
- Customization: Template variables and placeholders
- Usage: Consumed by generator package

### Common Development Issues (Troubleshooting)
[Source: Architecture and common monorepo patterns]

**Issue 1: pnpm workspace resolution errors**
- Symptom: "Cannot find module '@openapi-to-mcp/parser'"
- Solution: Run `pnpm install` at root, ensure pnpm-workspace.yaml is correct

**Issue 2: TypeScript compilation errors across packages**
- Symptom: "Cannot find type definition for module"
- Solution: Build packages in order, ensure tsconfig references are correct

**Issue 3: Test failures after dependency updates**
- Symptom: Tests fail after `pnpm update`
- Solution: Clear node_modules, reinstall, check for breaking changes

**Issue 4: CI/CD pipeline failures**
- Symptom: Tests pass locally but fail in CI
- Solution: Check Node.js version, clear cache, review environment differences

**Issue 5: Dependency version conflicts**
- Symptom: Multiple versions of same package installed
- Solution: Use pnpm's strict resolution, check for conflicting peer dependencies

### Architecture Documentation Alignment
[Source: docs/architecture/README.md]

**Existing Architecture Docs**:
- `docs/architecture/architecture.md` - Main architecture (706 lines)
- `docs/architecture/architecture-data-models.md` - Data models
- `docs/architecture/architecture-workflows.md` - Workflows
- `docs/architecture/architecture-validation.md` - Validation report

**Updates Needed**:
- Verify monorepo structure section matches implemented structure
- Ensure source tree diagram is accurate
- Add development workflow section if missing
- Link to package READMEs once created

### Example Development Workflow
[Source: docs/architecture/architecture.md#coding-standards and Story 1.6]

**Typical Development Workflow**:
```bash
# 1. Create feature branch
git checkout -b feature/story-2.1-openapi-loader

# 2. Make changes to code
# Edit files in packages/parser/src/

# 3. Run tests locally
npm test --workspace=packages/parser

# 4. Check TypeScript compilation
npm run build --workspace=packages/parser

# 5. Run linter
npm run lint

# 6. Run full test suite
npm test

# 7. Commit changes
git add .
git commit -m "feat(parser): implement OpenAPI document loading"

# 8. Push branch and create PR
git push origin feature/story-2.1-openapi-loader
# Create PR via GitHub UI

# 9. Address review feedback
# Make changes, commit, push

# 10. Merge PR after approval
# Squash and merge or merge commit based on team preference
```

### PR Template Guidance
[Source: GitHub best practices]

**PR Template** (`.github/PULL_REQUEST_TEMPLATE.md`):
```markdown
## Description
Brief description of changes

## Story/Issue Reference
Closes #123 (Story 2.1)

## Type of Change
- [ ] New feature (Story implementation)
- [ ] Bug fix
- [ ] Documentation update
- [ ] Refactoring

## Testing
- [ ] Unit tests added/updated
- [ ] Integration tests added/updated
- [ ] Coverage ≥80%
- [ ] All tests pass locally

## Checklist
- [ ] Code follows style guidelines
- [ ] Self-review completed
- [ ] Documentation updated
- [ ] No new warnings
- [ ] TypeScript compiles without errors
```

### File Locations
[Source: docs/architecture/architecture.md#source-tree]

**Files to Create**:
- `CONTRIBUTING.md` (repository root)
- `packages/cli/README.md`
- `packages/parser/README.md`
- `packages/generator/README.md`
- `packages/templates/README.md`
- `.github/PULL_REQUEST_TEMPLATE.md`
- `.github/ISSUE_TEMPLATE/bug_report.md` (optional)
- `.github/ISSUE_TEMPLATE/feature_request.md` (optional)

**Files to Update**:
- `docs/architecture/architecture.md` (verify monorepo structure)
- `README.md` (ensure it links to CONTRIBUTING.md)

**Files to Reference** (not modify):
- `docs/architecture/architecture-data-models.md`
- `docs/architecture/architecture-workflows.md`
- `docs/architecture/architecture-validation.md`
- `vitest.config.ts` (Story 1.6)
- `pnpm-workspace.yaml` (Story 1.1)

### Previous Story Context

**Story 1.1** (Project Repository Setup):
- Created monorepo structure with pnpm workspaces
- Configured TypeScript with strict mode
- Set up ESLint and Prettier
- Created initial package directories

**Story 1.2** (CI/CD Pipeline):
- Created `.github/workflows/test.yml`
- Set up matrix testing (Node 18/20/22, Ubuntu/macOS/Windows)
- Configured status checks for PRs

**Story 1.3** (CLI Framework):
- Implemented CLI with Commander.js
- Created `generate` command with flags
- Set up bin configuration for `npx openapi-to-mcp`

**Story 1.6** (Testing Framework):
- Configured Vitest at workspace root
- Set coverage thresholds (≥80%)
- Created test scripts: `npm test`, `npm run test:coverage`

**Story 1.7** (Error Handling - Draft):
- Designed error hierarchy and logging system
- Implemented custom error classes
- Set up `debug` library for logging

**Key Takeaway**: Documentation should reflect the implemented structure from Stories 1.1-1.7, not just the planned architecture.

## Testing

### Testing Standards
[Source: docs/architecture/architecture.md#test-strategy]

**Test Framework**: Vitest 1.2.0 (configured in Story 1.6)
**Coverage Target**: ≥80% line coverage (enforced)

**Test Execution**:
```bash
# Run all tests
npm test

# Run with coverage
npm run test:coverage

# Run specific package tests
npm test --workspace=packages/cli
```

### Story-Specific Testing Requirements

**Documentation Validation**:
- Manual review of all documentation files
- Link validation (ensure all links work)
- Code example validation (ensure examples compile and run)
- Setup instruction testing (test on clean environment)

**CONTRIBUTING.md Validation**:
- Follow setup instructions on fresh clone
- Verify all commands work as documented
- Test troubleshooting solutions
- Verify PR process description is accurate

**Package README Validation**:
- Each README accurately describes package purpose
- API examples compile and run
- Links to architecture docs work
- Code examples are accurate

**Architecture Documentation Validation**:
- Monorepo structure diagram matches actual structure
- All references to packages are accurate
- Links between architecture docs work

**Acceptance Criteria**:
- All documentation follows consistent formatting
- All code examples are tested and accurate
- All links are validated and working
- Setup instructions tested on clean environment
- Troubleshooting guide covers common issues from Stories 1.1-1.7
- PR template and issue templates are complete

**No Unit Tests Required**: This story is documentation-focused with manual validation rather than automated testing.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-03 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-01-04 | 1.1 | Validation complete - no corrections needed, approved for development | Sarah (Product Owner) |

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

### Agent Model Used

*To be completed by Dev Agent*

### Debug Log References

*To be completed by Dev Agent*

### Completion Notes List

*To be completed by Dev Agent*

### File List

*To be completed by Dev Agent*

## QA Results

*This section will be populated by QA Agent after story completion.*
