# Story 4.8: Credential Security Best Practices Documentation - Brownfield Addition

**Epic:** Epic 4: Authentication & Security Handlers

---

## User Story

**As a** user,
**I want** documentation on credential security best practices,
**So that** I can securely manage API credentials for the generated MCP server.

---

## Story Context

**Existing System Integration:**
- Integrates with: All Epic 4 stories, scaffolding (3.8), documentation
- Technology: Security documentation, best practices guides
- Follows pattern: Security-first documentation
- Touch points: README, SECURITY.md, .gitignore, deployment guides

**Epic Context:**
Provides comprehensive security documentation for credential management. Educates users on secure practices for storing, rotating, and deploying API credentials.

---

## Acceptance Criteria

### Functional Requirements

1. **SECURITY.md Creation:** Generate `SECURITY.md` in project root with best practices
2. **Environment Variable Security:** Explain why .env files must never be committed
3. **.gitignore Verification:** Ensure .env is ignored by git
4. **Credential Rotation:** Document how to rotate credentials safely
5. **Production Deployment:** Guidance on secret management (AWS Secrets Manager, Vault, etc.)
6. **Least Privilege:** Document using minimal credential scopes
7. **Logging Security:** Explain why credentials should never appear in logs
8. **Error Message Security:** Avoiding credential exposure in error messages
9. **HTTPS Requirement:** Emphasize using HTTPS for API communication
10. **Local Development:** Best practices for local .env file management
11. **Team Collaboration:** Sharing .env.example (not .env) with team
12. **Credential Storage:** Warn against storing credentials in code/version control
13. **Security Checklist:** Checklist for users to verify before deployment
14. **External References:** Link to OWASP, NIST security standards

### Documentation Requirements

15. **README Security Section:** Add security overview to main README
16. **.env.example Comments:** Security warnings in environment template
17. **Deployment Guide:** Secure deployment instructions
18. **Troubleshooting:** Security-related troubleshooting

---

## Technical Notes

**SECURITY.md Template:**
```markdown
# Security Best Practices

## Credential Management

### ⚠️ Never Commit Credentials

**CRITICAL:** Never commit your `.env` file or API credentials to version control.

- Always use `.env` for local credentials
- Share `.env.example` (without real values) with your team
- Verify `.env` is in `.gitignore` before committing

### Environment Variables

Store all credentials in environment variables:

```bash
# ✅ GOOD: Environment variable
API_KEY=abc123

# ❌ BAD: Hardcoded in source code
const apiKey = "abc123";  // NEVER DO THIS
```

### Credential Rotation

Rotate API credentials regularly:

1. Generate new credentials in API provider dashboard
2. Update `.env` file with new credentials
3. Restart MCP server to load new credentials
4. Revoke old credentials in API provider dashboard

**Frequency:** Rotate credentials every 90 days or immediately if compromised.

### Production Deployment

For production deployments, use secure secret management:

**AWS Secrets Manager:**
```bash
# Fetch secret from AWS Secrets Manager
export API_KEY=$(aws secretsmanager get-secret-value --secret-id prod/api-key --query SecretString --output text)
npm start
```

**HashiCorp Vault:**
```bash
# Fetch secret from Vault
export API_KEY=$(vault kv get -field=api_key secret/mcp-server)
npm start
```

**Docker Secrets:**
```bash
# Use Docker secrets for containerized deployments
docker service create \
  --secret api_key \
  --env API_KEY_FILE=/run/secrets/api_key \
  mcp-server
```

### Security Checklist

Before deploying to production, verify:

- [ ] `.env` file is NOT committed to git
- [ ] `.gitignore` includes `.env`
- [ ] API credentials use least privilege (minimal required permissions)
- [ ] HTTPS is used for all API communication
- [ ] Credentials are stored in secure secret manager (not .env in production)
- [ ] Debug logging is disabled in production (`DEBUG=false`)
- [ ] Credentials are rotated regularly
- [ ] Team members use individual API keys (not shared credentials)

## Logging Security

### Safe Logging

Never log credentials:

```typescript
// ✅ GOOD: Masked credentials
console.log('API Key: ***hidden***');

// ❌ BAD: Exposed credentials
console.log(`API Key: ${apiKey}`);  // NEVER DO THIS
```

The generated MCP server automatically masks credentials in logs.

### Error Messages

Ensure error messages don't expose credentials:

```typescript
// ✅ GOOD: Generic error
throw new Error('Authentication failed');

// ❌ BAD: Credential in error
throw new Error(`Auth failed with key: ${apiKey}`);  // NEVER DO THIS
```

## HTTPS Requirement

**Always use HTTPS** for API communication:

- Credentials transmitted over HTTP can be intercepted
- Set `API_BASE_URL` to `https://` (not `http://`)
- Verify SSL certificates are valid

## Local Development

### .env File Management

1. Copy `.env.example` to `.env`
2. Add your development credentials
3. Never share your `.env` file
4. Use different credentials for dev/staging/prod

### Team Collaboration

Share configuration template, not credentials:

```bash
# ✅ GOOD: Share .env.example
git add .env.example
git commit -m "Update env template"

# ❌ BAD: Share .env with credentials
git add .env  # NEVER DO THIS
```

## Least Privilege Principle

Use minimal required permissions:

1. Create API keys with only necessary scopes
2. Avoid admin/full-access credentials
3. Create separate keys for different environments
4. Revoke unused keys immediately

## Security Incident Response

If credentials are compromised:

1. **Immediately revoke** compromised credentials
2. **Rotate** all related credentials
3. **Audit** access logs for unauthorized usage
4. **Update** `.env` with new credentials
5. **Restart** MCP server

## External Resources

- [OWASP API Security Top 10](https://owasp.org/www-project-api-security/)
- [NIST Password Guidelines](https://pages.nist.gov/800-63-3/)
- [12-Factor App Config](https://12factor.net/config)
- [AWS Secrets Manager Best Practices](https://docs.aws.amazon.com/secretsmanager/latest/userguide/best-practices.html)

---

Generated with [OpenAPI-to-MCP Generator](https://github.com/your-org/openapi-to-mcp)
```

---

## Definition of Done

- [ ] SECURITY.md created with comprehensive guide
- [ ] Environment variable security documented
- [ ] .gitignore includes .env
- [ ] Credential rotation guide complete
- [ ] Production deployment guide complete
- [ ] Least privilege documented
- [ ] Logging security explained
- [ ] HTTPS requirement emphasized
- [ ] Local development best practices
- [ ] Team collaboration guidelines
- [ ] Security checklist provided
- [ ] External references included
- [ ] README security section added
- [ ] .env.example has security warnings

---

## Success Criteria

1. ✅ SECURITY.md comprehensive and actionable
2. ✅ Users understand credential security
3. ✅ .gitignore prevents .env commits
4. ✅ Production deployment secure
5. ✅ Security checklist helps users verify setup
6. ✅ External resources provided
7. ✅ Ready for Integration Testing (Story 4.9)

---

**Story Created:** 2025-01-04  
**Epic:** Epic 4  
**Story Number:** 4.8  
**Estimated Effort:** 3-4 hours
