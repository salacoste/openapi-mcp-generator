# Story 1.1: Project Repository Setup and Monorepo Structure

## Status

**Draft**

---

## Story

**As a** developer,
**I want** a properly configured monorepo with workspaces, linting, and TypeScript setup,
**so that** I have a solid foundation for developing multiple packages with shared tooling.

---

## Acceptance Criteria

1. Repository created with monorepo structure (`packages/cli`, `packages/parser`, `packages/generator`, `packages/templates`)
2. Package manager (npm/pnpm workspaces) configured for cross-package dependencies
3. Root `package.json` with workspace configuration and shared dev dependencies
4. TypeScript configured with `tsconfig.json` (strict mode, ES modules)
5. ESLint and Prettier configured with consistent rules across all packages
6. Git repository initialized with `.gitignore` for `node_modules`, `dist`, `.env`
7. Basic `README.md` with project overview and development setup instructions
8. All packages can be installed with single command (`npm install` at root)

---

## Tasks / Subtasks

- [ ] **Task 1: Initialize Repository and Git Configuration** (AC: 1, 6)
  - [ ] Verify current git repository exists or initialize new one with `git init`
  - [ ] Create `.gitignore` with entries: `node_modules/`, `dist/`, `.env`, `*.log`, coverage/
  - [ ] Verify `.gitignore` prevents committing sensitive files

- [ ] **Task 2: Create Monorepo Directory Structure** (AC: 1)
  - [ ] Create directory structure: `packages/cli/`, `packages/parser/`, `packages/generator/`, `packages/templates/`
  - [ ] Create placeholder `package.json` files in each package directory
  - [ ] Create `src/` and `__tests__/` directories within each package
  - [ ] Verify all directories exist and are accessible

- [ ] **Task 3: Configure pnpm Workspace** (AC: 2, 3)
  - [ ] Create `pnpm-workspace.yaml` at project root with workspace pattern `packages/*`
  - [ ] Create root `package.json` with workspace configuration
  - [ ] Add shared dev dependencies: `typescript@5.3.3`, `vitest@1.2.0`, `eslint@8.56.0`, `prettier@3.2.4`
  - [ ] Set package manager to pnpm 8.15.1 in root package.json
  - [ ] Configure private: true in root package.json
  - [ ] Verify workspace configuration syntax

- [ ] **Task 4: Configure TypeScript with Strict Mode** (AC: 4)
  - [ ] Create root `tsconfig.json` with strict mode enabled and ES module target
  - [ ] Configure TypeScript compiler options: `"strict": true`, `"target": "ES2022"`, `"module": "ESNext"`, `"moduleResolution": "node"`
  - [ ] Set `"esModuleInterop": true`, `"skipLibCheck": true`, `"forceConsistentCasingInFileNames": true`
  - [ ] Create package-specific `tsconfig.json` files extending root config
  - [ ] Verify TypeScript configuration compiles successfully

- [ ] **Task 5: Configure ESLint and Prettier** (AC: 5)
  - [ ] Create `.eslintrc.json` with TypeScript plugin and recommended rules
  - [ ] Configure ESLint for strict mode: `@typescript-eslint/eslint-plugin@6.19.0`
  - [ ] Create `.prettierrc.json` with consistent formatting rules: `semi: true`, `singleQuote: true`, `trailingComma: 'es5'`
  - [ ] Add npm scripts: `"lint": "eslint . --ext .ts"`, `"format": "prettier --write \"**/*.{ts,json,md}\""`
  - [ ] Test linting and formatting on sample TypeScript file

- [ ] **Task 6: Create Project README** (AC: 7)
  - [ ] Create `README.md` with project overview and problem statement
  - [ ] Add development setup instructions: Node.js version requirement (≥18.0.0), pnpm installation
  - [ ] Document installation command: `pnpm install`
  - [ ] Add basic usage example placeholder
  - [ ] Include project structure diagram showing packages

- [ ] **Task 7: Install Dependencies and Verify Setup** (AC: 8)
  - [ ] Run `pnpm install` from project root
  - [ ] Verify all packages install successfully without errors
  - [ ] Verify workspace linking works between packages
  - [ ] Run `pnpm -r exec tsc --noEmit` to verify TypeScript compiles
  - [ ] Run `pnpm run lint` to verify ESLint works across all packages
  - [ ] Confirm all packages are accessible and dependencies resolve correctly

---

## Dev Notes

### Previous Story Insights

No previous story exists - this is the first story in Epic 1.

---

### Architecture Context

This story implements the foundational monorepo structure that will house all four specialized packages as defined in the architecture.

**[Source: docs/architecture/architecture.md#high-level-architecture]**

---

### Tech Stack

**Package Manager:**
- **pnpm 8.15.1** - Monorepo workspace management, 30-50% faster installs, strict dependency resolution
- Rationale: Simplifies dependency management and versioning, enables code sharing between packages, single CI/CD pipeline

**Runtime:**
- **Node.js 20.11.0 LTS** - JavaScript runtime (MCP SDK requires ≥18.0.0, v20 LTS stable through 2026)

**Language:**
- **TypeScript 5.3.3** - Primary development language with strict typing to prevent runtime errors

**Development Tools:**
- **ESLint 8.56.0** - Code quality enforcement (industry standard)
- **Prettier 3.2.4** - Code formatting (opinionated, zero-config)
- **Vitest 1.2.0** - Unit + integration testing (native ESM support, 2-5x faster than Jest)

**[Source: docs/architecture/architecture.md#tech-stack]**

---

### Monorepo Structure

**Required Directory Layout:**
```
openapi-to-mcp/
├── packages/
│   ├── cli/              # Command-line interface
│   ├── parser/           # OpenAPI 3.0 parsing
│   ├── generator/        # Code generation engine
│   └── templates/        # Boilerplate templates
├── examples/             # Real-world test cases
├── docs/                 # Architecture + API docs
└── tests/                # Cross-package integration tests
```

**Each package must contain:**
- `src/` - Source code directory
- `__tests__/` - Test files directory
- `package.json` - Package configuration
- `tsconfig.json` - Package-specific TypeScript config extending root

**[Source: docs/architecture/architecture.md#high-level-architecture]**

---

### TypeScript Configuration Requirements

**Strict Mode Configuration:**
- `"strict": true` - Enable all strict type-checking options
- `"target": "ES2022"` - Modern JavaScript target
- `"module": "ESNext"` - ES module system (ESM only per coding standards)
- `"moduleResolution": "node"` - Node.js module resolution
- `"esModuleInterop": true` - Interop between CommonJS and ESM
- `"skipLibCheck": true` - Skip type checking of declaration files
- `"forceConsistentCasingInFileNames": true` - Enforce consistent casing

**Module System:**
- **ESM only** - Use `import`/`export`, no CommonJS (`require`)

**[Source: docs/architecture/architecture.md#coding-standards]**

---

### Linting and Formatting Standards

**ESLint Configuration:**
- Base: `eslint@8.56.0`
- TypeScript plugin: `@typescript-eslint/eslint-plugin@6.19.0`
- Recommended rules for TypeScript projects

**Prettier Configuration:**
- `"semi": true` - Always use semicolons
- `"singleQuote": true` - Use single quotes
- `"trailingComma": "es5"` - Trailing commas where valid in ES5

**Required Scripts:**
- `"lint": "eslint . --ext .ts"` - Run linting
- `"format": "prettier --write \"**/*.{ts,json,md}\""` - Format code

**[Source: docs/architecture/architecture.md#coding-standards]**

---

### Git Configuration

**Required .gitignore Entries:**
```
node_modules/
dist/
.env
*.log
coverage/
.vscode/
.idea/
*.swp
*.swo
.DS_Store
```

**[Source: docs/architecture/architecture.md#coding-standards]**

---

### Package Configuration

**Root package.json Structure:**
```json
{
  "name": "openapi-to-mcp",
  "version": "0.0.1",
  "private": true,
  "packageManager": "pnpm@8.15.1",
  "workspaces": ["packages/*"],
  "scripts": {
    "lint": "eslint . --ext .ts",
    "format": "prettier --write \"**/*.{ts,json,md}\"",
    "test": "vitest"
  },
  "devDependencies": {
    "typescript": "5.3.3",
    "vitest": "1.2.0",
    "eslint": "8.56.0",
    "prettier": "3.2.4",
    "@typescript-eslint/eslint-plugin": "6.19.0",
    "@typescript-eslint/parser": "6.19.0"
  }
}
```

**pnpm-workspace.yaml Structure:**
```yaml
packages:
  - 'packages/*'
```

**[Source: docs/architecture/architecture.md#high-level-architecture]**

---

### Coding Standards to Follow

**Critical Rules (from Architecture):**
1. **Module System:** ESM only (`import`/`export`) - No CommonJS
2. **TypeScript:** Strict mode enabled, all async must have error handling
3. **File Operations:** Use absolute paths with `path.resolve()`
4. **Secrets:** Never hardcode secrets, use `process.env`
5. **Type Safety:** Use `unknown` not `any`, avoid non-null assertions
6. **All errors must be typed** - Use custom error classes (will be implemented in Story 1.7)

**[Source: docs/architecture/architecture.md#coding-standards]**

---

### Project Structure Notes

**Alignment with Architecture:**
- This story establishes the foundation for the modular CLI pipeline architecture
- Creates the workspace structure that enables cross-package type safety and shared tooling
- Sets up the build infrastructure that will support both template-based and AST manipulation code generation

**No Conflicts Identified** - The acceptance criteria align perfectly with the architecture requirements.

---

### Testing

#### Testing Standards

**Test Framework:**
- **Vitest 1.2.0** - Native ESM support, 2-5x faster than Jest

**Test Directory Structure:**
- Each package must have `__tests__/` directory for test files
- Test files use `.test.ts` or `.spec.ts` extension

**Coverage Requirements:**
- **Unit Tests:** ≥80% line coverage
- **Integration Tests:** ≥70% workflows
- **E2E Tests:** 100% commands

**Testing Philosophy:**
- **TDD Approach** for critical paths (Epics 2-6)
- **AAA Pattern** (Arrange, Act, Assert) for unit tests
- **Mock all external dependencies** in unit tests

**Test Pyramid Distribution:**
```
         E2E (5%)
    Integration (25%)
  Unit Tests (70%)
```

**Required Test Script:**
```json
{
  "scripts": {
    "test": "vitest"
  }
}
```

**Testing Infrastructure for This Story:**
- Story 1.6 will add comprehensive testing framework setup
- This story focuses on workspace structure foundation
- No tests required for initial directory and config setup

**[Source: docs/architecture/architecture.md#test-strategy]**

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-03 | 1.0 | Initial story creation | Bob (Scrum Master) |

---

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

### Agent Model Used

*To be filled by Dev Agent*

### Debug Log References

*To be filled by Dev Agent*

### Completion Notes List

*To be filled by Dev Agent*

### File List

*To be filled by Dev Agent*

---

## QA Results

*This section will be populated by QA Agent after story completion.*
