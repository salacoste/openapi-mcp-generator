# Story 1.5: Hello World MCP Server Template and Generation

## Status

Approved

## Story

**As a** user,
**I want** the CLI to generate a minimal "hello world" MCP server,
**so that** I can verify the end-to-end pipeline works before building full features.

## Acceptance Criteria

1. Template created in `packages/templates/hello-world/` with minimal MCP server code
2. Template includes: `src/index.ts` (MCP server with one `hello` tool), `package.json`, `README.md`, `.env.example`
3. CLI `generate` command copies hello-world template to output directory
4. Generated `package.json` includes correct dependencies: `@modelcontextprotocol/sdk`, `dotenv`
5. Generated `README.md` includes setup instructions and example usage
6. Generated code compiles successfully with TypeScript (`tsc`)
7. Generated MCP server can be started with `node dist/index.js`
8. Generated MCP server responds to `hello` tool invocation with "Hello from MCP!"
9. Success message displayed after generation: "✅ MCP server generated successfully at <output-dir>"
10. Verbose mode shows step-by-step generation progress

## Tasks / Subtasks

- [ ] Create Templates package structure (AC: 1)
  - [ ] Create `packages/templates/` directory
  - [ ] Create `packages/templates/hello-world/` directory
  - [ ] Create `packages/templates/hello-world/src/` directory
  - [ ] Verify directory structure matches monorepo pattern

- [ ] Create Templates package.json (AC: 1)
  - [ ] Create `packages/templates/package.json`
  - [ ] Set package name: `@openapi-to-mcp/templates`
  - [ ] Set version: `0.1.0`
  - [ ] Set type: `module` (ESM)
  - [ ] Add build script: `"build": "echo 'Templates package contains static files'"`
  - [ ] Add test script: `"test": "echo 'No tests for templates package'"`
  - [ ] Mark as private: `"private": true`

- [ ] Create hello-world template server code (AC: 1, 2, 8)
  - [ ] Create `packages/templates/hello-world/src/index.ts`
  - [ ] Add shebang: `#!/usr/bin/env node`
  - [ ] Import MCP SDK: `import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";`
  - [ ] Import stdio transport: `import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";`
  - [ ] Import zod: `import { z } from "zod";`
  - [ ] Create server instance with name "hello-world-mcp" and version "1.0.0"
  - [ ] Register `hello` tool with empty input schema
  - [ ] Return "Hello from MCP!" in tool response
  - [ ] Connect to StdioServerTransport
  - [ ] Wrap in async main function with error handling

- [ ] Create hello-world template package.json (AC: 2, 4)
  - [ ] Create `packages/templates/hello-world/package.json`
  - [ ] Set name: `hello-world-mcp`
  - [ ] Set version: `1.0.0`
  - [ ] Set type: `module` (ESM)
  - [ ] Set main: `./dist/index.js`
  - [ ] Add dependency: `@modelcontextprotocol/sdk@0.5.0` (exact version)
  - [ ] Add dependency: `dotenv@16.4.1` (exact version)
  - [ ] Add dependency: `zod@3.22.4` (exact version for MCP SDK)
  - [ ] Add dev dependencies: `typescript@5.3.3`, `@types/node@20.11.0`, `tsup@8.0.1`
  - [ ] Add build script: `"build": "tsup src/index.ts --format esm --dts"`
  - [ ] Add dev script: `"dev": "tsup src/index.ts --format esm --watch"`
  - [ ] Set engines.node: `">=18.0.0"` (MCP SDK requirement)

- [ ] Create hello-world tsconfig.json (AC: 6)
  - [ ] Create `packages/templates/hello-world/tsconfig.json`
  - [ ] Set target: `ES2022`
  - [ ] Set module: `ES2022`
  - [ ] Set moduleResolution: `node`
  - [ ] Enable strict mode
  - [ ] Set outDir: `dist`
  - [ ] Set rootDir: `src`
  - [ ] Include src/**/*

- [ ] Create hello-world README.md (AC: 2, 5)
  - [ ] Create `packages/templates/hello-world/README.md`
  - [ ] Add project title: "Hello World MCP Server"
  - [ ] Add description: "A minimal MCP server generated by openapi-to-mcp"
  - [ ] Add setup instructions: npm install, npm run build
  - [ ] Add usage instructions: node dist/index.js
  - [ ] Add MCP client configuration example for Claude Desktop
  - [ ] Add example tool invocation
  - [ ] Add link to MCP documentation
  - [ ] Note: Generated by openapi-to-mcp

- [ ] Create hello-world .env.example (AC: 2)
  - [ ] Create `packages/templates/hello-world/.env.example`
  - [ ] Add comment: "# Environment variables for MCP server"
  - [ ] Add placeholder: `# Add your environment variables here`
  - [ ] Add example: `# API_KEY=your-api-key-here`
  - [ ] Add note about not committing .env file

- [ ] Create hello-world .gitignore (AC: 6)
  - [ ] Create `packages/templates/hello-world/.gitignore`
  - [ ] Ignore: `node_modules/`, `dist/`, `.env`, `*.log`
  - [ ] Add comment explaining each ignore pattern

- [ ] Integrate template copying into CLI generate command (AC: 3, 9, 10)
  - [ ] Import generator fs-utils in generate.ts
  - [ ] Import path module for template path resolution
  - [ ] Get template source path: `path.resolve(__dirname, '../../../templates/hello-world')`
  - [ ] Call `checkOutputDirectory(outputPath, options.force)` before copying
  - [ ] Call `copyTemplate(templatePath, outputPath)` with error handling
  - [ ] Log each step if verbose flag enabled
  - [ ] Display success message with output path
  - [ ] Handle template not found error gracefully

- [ ] Create end-to-end integration test (AC: 3, 6, 7, 8)
  - [ ] Create `packages/cli/__tests__/e2e/generate.test.ts`
  - [ ] Test: CLI generates hello-world template to temp directory
  - [ ] Test: Generated package.json has correct dependencies
  - [ ] Test: Generated TypeScript compiles without errors
  - [ ] Test: Generated server starts successfully
  - [ ] Test: Generated server responds to hello tool invocation
  - [ ] Test: --force flag overwrites existing output
  - [ ] Test: --verbose shows generation steps
  - [ ] Use temp directories for test isolation
  - [ ] Clean up test directories after each test

- [ ] Manual testing and validation (AC: 6, 7, 8)
  - [ ] Run CLI: `node packages/cli/dist/index.js generate dummy.yaml -o /tmp/test-mcp`
  - [ ] Navigate to output: `cd /tmp/test-mcp`
  - [ ] Install dependencies: `npm install`
  - [ ] Build server: `npm run build`
  - [ ] Verify dist/index.js exists with shebang
  - [ ] Test server starts: `node dist/index.js`
  - [ ] Verify server initializes without errors
  - [ ] Test with MCP Inspector or client (manual verification)

- [ ] Update CLI package.json dependencies (AC: 3)
  - [ ] Add generator package dependency to CLI
  - [ ] Verify workspace linking works
  - [ ] Test CLI can import generator fs-utils

- [ ] Documentation updates (AC: 5, 9)
  - [ ] Update root README.md with generation example
  - [ ] Document hello-world template structure
  - [ ] Add quickstart guide: generate → install → build → run
  - [ ] Add troubleshooting section

## Dev Notes

### MCP Server Architecture
[Source: Context7 - /modelcontextprotocol/typescript-sdk]

**MCP (Model Context Protocol)** is Anthropic's protocol for connecting AI assistants to external data sources and tools. MCP servers expose resources, tools, and prompts that Claude can use.

**Core MCP Concepts**:
1. **Server**: Provides tools, resources, and prompts to clients (Claude)
2. **Transport**: Communication layer (stdio for CLI, HTTP+SSE for web)
3. **Tools**: Functions Claude can call (like our `hello` tool)
4. **Resources**: Data Claude can read (files, databases, APIs)
5. **Prompts**: Templates for Claude conversations

### MCP TypeScript SDK Integration
[Source: Context7 - /modelcontextprotocol/typescript-sdk examples]

**SDK Version**: `@modelcontextprotocol/sdk@0.5.0` (exact version per architecture)

**Why MCP SDK:**
- Official Anthropic implementation
- Type-safe TypeScript API
- Built-in stdio transport for CLI
- Zod schema validation

**Basic MCP Server Pattern**:
```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";

// 1. Create server instance
const server = new McpServer({
  name: "hello-world-mcp",
  version: "1.0.0"
});

// 2. Register tools
server.registerTool(
  "hello",  // Tool name
  {
    title: "Hello Tool",
    description: "Returns a greeting",
    inputSchema: {}  // No parameters needed
  },
  async () => ({
    content: [{ type: "text", text: "Hello from MCP!" }]
  })
);

// 3. Connect to transport
const transport = new StdioServerTransport();
await server.connect(transport);
```

**Tool Response Format**:
- `content`: Array of content blocks
- Each block has `type` (text, image, resource) and data
- For simple text responses: `[{ type: "text", text: "..." }]`

**Input Schema with Zod**:
```typescript
// Tool with parameters
server.registerTool(
  "add",
  {
    title: "Addition Tool",
    inputSchema: { a: z.number(), b: z.number() }
  },
  async ({ a, b }) => ({
    content: [{ type: "text", text: String(a + b) }]
  })
);
```

**Error Handling Pattern**:
```typescript
async function main() {
  try {
    const server = new McpServer({ name: "example", version: "1.0.0" });
    // ... setup ...
    const transport = new StdioServerTransport();
    await server.connect(transport);
  } catch (error) {
    console.error("Server error:", error);
    process.exit(1);
  }
}

main();
```

### Stdio Transport for CLI Integration
[Source: Context7 - /modelcontextprotocol/typescript-sdk]

**Why Stdio Transport:**
- Perfect for CLI tools and local MCP servers
- Uses stdin/stdout for JSON-RPC communication
- No HTTP server needed
- Works with Claude Desktop MCP client

**How Claude Desktop Connects**:
1. User configures server in Claude Desktop settings
2. Claude launches server process (e.g., `node dist/index.js`)
3. Claude sends JSON-RPC requests via stdin
4. Server responds via stdout
5. stderr used for logging (not protocol messages)

**MCP Inspector for Testing**:
```bash
# Install MCP Inspector
npm install -g @modelcontextprotocol/inspector

# Test hello-world server
mcp-inspector node dist/index.js
```

### Template Structure and Generation
[Source: docs/architecture/architecture.md#component-4-templates-package]

**Templates Package Purpose**:
- Store reusable code templates for MCP server generation
- hello-world template validates end-to-end pipeline
- Future templates: full OpenAPI servers (Stories 3.x+)

**Hello-World Template Structure**:
```
packages/templates/hello-world/
├── src/
│   └── index.ts          # MCP server with hello tool
├── package.json          # Dependencies (MCP SDK, dotenv, zod)
├── tsconfig.json         # TypeScript config
├── README.md             # Setup and usage instructions
├── .env.example          # Environment variable template
└── .gitignore            # Git ignore patterns
```

**Generated Output Structure** (matches AC #6):
```
<output-dir>/
├── src/
│   └── index.ts
├── package.json
├── tsconfig.json
├── README.md
├── .env.example
└── .gitignore
```

### Integration with Generator Package
[Source: Story 1.4 context - fs-utils]

**Generator Functions Used**:
1. `checkOutputDirectory(path, force)` - Validates/clears output directory
2. `copyTemplate(source, dest)` - Copies template recursively
3. `log(message)` - Verbose logging when VERBOSE=true

**Integration Flow**:
```typescript
// In CLI generate.ts
import { checkOutputDirectory, copyTemplate } from '@openapi-to-mcp/generator';
import { resolve } from 'path';

// Get template path (relative to CLI dist)
const templatePath = resolve(__dirname, '../../../templates/hello-world');

// Check/clear output directory
await checkOutputDirectory(outputPath, options.force);

// Copy template
await copyTemplate(templatePath, outputPath);

// Success message
console.log(`✅ MCP server generated successfully at ${outputPath}`);
```

### Dependencies and Version Requirements
[Source: docs/architecture/architecture.md#tech-stack]

**Generated MCP Server Dependencies**:
- `@modelcontextprotocol/sdk@0.5.0` - Official MCP protocol implementation
- `dotenv@16.4.1` - Environment variable loading
- `zod@3.22.4` - Schema validation (required by MCP SDK)

**Dev Dependencies**:
- `typescript@5.3.3` - TypeScript compiler
- `@types/node@20.11.0` - Node.js type definitions
- `tsup@8.0.1` - TypeScript bundler

**Node.js Version Requirement**:
- Minimum: Node.js 18.0.0 (MCP SDK requirement)
- Recommended: Node.js 20.11.0 LTS

### ESM Configuration Requirements
[Source: docs/architecture/architecture.md#coding-standards]

**Critical ESM Rules** (same as Stories 1.3-1.4):
1. All `package.json` files must have `"type": "module"`
2. All imports must use `.js` extensions: `import { x } from './y.js';`
3. Shebang required in server entry point: `#!/usr/bin/env node`
4. Use `import.meta.url` instead of `__dirname` if needed

### README.md Content Template
[Source: AC #5 - Setup and usage instructions]

**Required Sections**:
1. **Project Title**: "Hello World MCP Server"
2. **Description**: Brief overview of generated server
3. **Setup Instructions**:
   ```bash
   npm install
   npm run build
   ```
4. **Usage Instructions**:
   - Running locally: `node dist/index.js`
   - Configuring in Claude Desktop
5. **MCP Client Configuration Example**:
   ```json
   {
     "mcpServers": {
       "hello-world": {
         "command": "node",
         "args": ["/path/to/dist/index.js"]
       }
     }
   }
   ```
6. **Available Tools**: List of tools (just "hello" for this template)
7. **Documentation Links**: Link to MCP docs
8. **Footer**: "Generated by openapi-to-mcp"

### Testing Strategy
[Source: docs/architecture/architecture.md#test-strategy]

**Test Levels**:
1. **Unit Tests**: Template file contents validation
2. **Integration Tests**: CLI generates template correctly
3. **E2E Tests**: Generated server compiles and runs
4. **Manual Tests**: MCP Inspector or Claude Desktop integration

**E2E Test Pattern**:
```typescript
import { describe, it, expect, beforeEach, afterEach } from 'vitest';
import { exec } from 'child_process';
import { promisify } from 'util';
import { tmpdir } from 'os';
import { mkdtemp, rm } from 'fs/promises';
import { join } from 'path';

const execAsync = promisify(exec);

describe('CLI generate command E2E', () => {
  let testDir: string;

  beforeEach(async () => {
    testDir = await mkdtemp(join(tmpdir(), 'mcp-test-'));
  });

  afterEach(async () => {
    await rm(testDir, { recursive: true, force: true });
  });

  it('should generate working MCP server', async () => {
    // Generate template
    await execAsync(`node packages/cli/dist/index.js generate dummy.yaml -o ${testDir}`);

    // Install and build
    await execAsync('npm install', { cwd: testDir });
    await execAsync('npm run build', { cwd: testDir });

    // Verify output
    const { stdout } = await execAsync('node dist/index.js --version', { cwd: testDir });
    expect(stdout).toContain('1.0.0');
  });
});
```

### Previous Story Context

**Story 1.3 Completion** (Done):
- CLI package with Commander.js
- Generate command with --output, --force, --verbose flags
- Error handling utilities ready

**Story 1.4 Context** (Draft):
- Generator package with fs-utils
- `copyTemplate()` function for template copying
- `checkOutputDirectory()` for output validation
- Verbose logging utility

**Key Takeaway**: This story connects CLI → Generator → Templates. It validates the entire pipeline: user runs CLI, generator copies template, user gets working MCP server.

### File Locations

**Files to Create**:
- `packages/templates/package.json`
- `packages/templates/hello-world/src/index.ts`
- `packages/templates/hello-world/package.json`
- `packages/templates/hello-world/tsconfig.json`
- `packages/templates/hello-world/README.md`
- `packages/templates/hello-world/.env.example`
- `packages/templates/hello-world/.gitignore`
- `packages/cli/__tests__/e2e/generate.test.ts`

**Files to Modify**:
- `packages/cli/src/commands/generate.ts` (integrate generator fs-utils)
- `packages/cli/package.json` (add generator dependency)
- Root `README.md` (add generation example)

**Project Structure Alignment**:
[Source: docs/architecture/architecture.md#source-tree]

```
openapi-to-mcp/
├── packages/
│   ├── cli/              # Story 1.3 (Done)
│   ├── generator/        # Story 1.4 (Draft)
│   └── templates/        # THIS STORY
│       ├── hello-world/
│       │   ├── src/
│       │   │   └── index.ts
│       │   ├── package.json
│       │   ├── tsconfig.json
│       │   ├── README.md
│       │   ├── .env.example
│       │   └── .gitignore
│       └── package.json
└── package.json
```

## Testing

### Testing Standards
[Source: docs/architecture/architecture.md#test-strategy]

**Test Framework**: Vitest 1.2.0
**Coverage Target**: ≥80% line coverage

**Test Execution**:
```bash
# Run all tests
npm test

# Run E2E tests only
npm test -- packages/cli/__tests__/e2e/
```

### Story-Specific Testing Requirements

**Unit Tests**:
1. Template file contents are valid TypeScript
2. Template package.json has correct structure
3. Template README.md contains required sections

**Integration Tests**:
1. CLI generate command copies template successfully
2. Generated files match template structure
3. --force flag clears existing directory before copying
4. --verbose shows each generation step
5. Success message displays correct output path

**E2E Tests** (Most Important):
1. **Generate + Install + Build**:
   - CLI generates template to temp directory
   - npm install succeeds in generated directory
   - npm run build compiles TypeScript successfully
   - dist/index.js exists with shebang

2. **Server Runtime**:
   - Generated server process starts without errors
   - Server listens on stdio transport
   - Server responds to basic JSON-RPC messages

3. **Tool Invocation**:
   - Hello tool is registered
   - Tool returns "Hello from MCP!" response
   - Response format is valid MCP protocol

**Manual Testing**:
1. Generate server to local directory
2. Build and run server manually
3. Test with MCP Inspector: `mcp-inspector node dist/index.js`
4. Test with Claude Desktop (optional, integration test)
5. Verify hello tool works as expected

**Acceptance**: E2E test passes (generate → build → run), manual MCP Inspector test shows hello tool responding correctly.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-03 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-01-04 | 1.1 | Validation complete - exceptional quality, approved for development | Sarah (Product Owner) |

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

### Agent Model Used

*To be completed by Dev Agent*

### Debug Log References

*To be completed by Dev Agent*

### Completion Notes List

*To be completed by Dev Agent*

### File List

*To be completed by Dev Agent*

## QA Results

*This section will be populated by QA Agent after story completion.*
